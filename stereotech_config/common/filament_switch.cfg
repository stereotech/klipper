[filament_switch_sensor extruder_switch]
switch_pin: main_extruder_filament_runout_swith
pause_on_runout: false
runout_gcode:
    FILAMENT_SWITCH_ACTION EXTRUDER=extruder
insert_gcode:
    FILAMENT_SWITCH_ACTION EXTRUDER=extruder ACTION=insert

[filament_switch_sensor extruder1_switch]
switch_pin: second_extruder_filament_runout_swith
pause_on_runout: false
runout_gcode:
    FILAMENT_SWITCH_ACTION EXTRUDER=extruder1
insert_gcode:
    FILAMENT_SWITCH_ACTION EXTRUDER=extruder1 ACTION=insert

[gcode_macro FILAMENT_SWITCH_ACTION]
gcode:
    {% set extruder = params.EXTRUDER|default('extruder') %}
    {% set extruder_index = 0 if extruder == 'extruder' else extruder[-1]|int %}
    {% set extruder_for_msg = 'extruder' if extruder == 'extruder' else 'extruder' ~ (extruder_index + 1) %}
    {% set action = params.ACTION|default('pause') %}
    {% if action == 'pause' %}
        {% if printer.virtual_sdcard.is_active %}
            PAUSE
        {% endif %}
        M117 {"triggered_filament_switch" ~ extruder_index}
        {action_respond_warning('412: The filament has run out in the %s' % extruder_for_msg)}
    {% else %}
        {action_respond_info('Insert filament in the %s' % extruder_for_msg)}
    {% endif %}
